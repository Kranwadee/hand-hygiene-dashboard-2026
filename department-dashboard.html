<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Department Dashboard - Hand Hygiene</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&family=Outfit:wght@500;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">


    <style>
        :root {
            --primary-green: #059669;
            --secondary-green: #10b981;
            --accent-green: #34d399;
            --bg-canvas: #f0fdf4;
            --card-white: #ffffff;
            --text-main: #0f172a;
            --text-sub: #64748b;
            --danger: #f43f5e;
            --success: #10b981;
            --warning: #f59e0b;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 8px 32px rgba(0, 0, 0, 0.08);
            --shadow-xl: 0 12px 48px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* =========================================
           GLOBAL STYLES
           ========================================= */
        body {
            font-family: 'Prompt', sans-serif;
            background-color: var(--bg-canvas);
            color: var(--text-main);
            min-height: 100vh;
            padding: 15px;
            overflow-x: hidden;
        }

        /* =========================================
           LOGIN SCREEN STYLES (Green Theme)
           ========================================= */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: linear-gradient(135deg, #059669 0%, #10b981 30%, #34d399 70%, #6ee7b7 100%);
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            overflow: hidden;
        }

        /* Animated Particles */
        .login-container::before {
            content: '';
            position: absolute;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            top: -100px;
            right: -100px;
            animation: float 8s ease-in-out infinite;
        }

        .login-container::after {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.08) 0%, transparent 70%);
            bottom: -50px;
            left: -50px;
            animation: float 10s ease-in-out infinite reverse;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            50% {
                transform: translateY(-20px) rotate(5deg);
            }
        }

        .login-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 50px 40px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(255, 255, 255, 0.2) inset;
            max-width: 420px;
            width: 100%;
            position: relative;
            z-index: 10;
            animation: fadeInUp 0.8s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #059669, #10b981);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            font-size: 36px;
            color: white;
            box-shadow: 0 15px 40px rgba(5, 150, 105, 0.4);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .login-card h1 {
            font-family: 'Outfit', sans-serif;
            font-size: 26px;
            font-weight: 700;
            color: #059669;
            margin-bottom: 8px;
            text-align: center;
        }

        .login-card p {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 30px;
            text-align: center;
        }

        .login-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 14px;
            font-size: 16px;
            font-family: 'Prompt', sans-serif;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            background: #f8fafc;
        }

        .login-input:focus {
            outline: none;
            border-color: #10b981;
            background: white;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.15);
        }

        /* Password Input Container */
        .password-container {
            position: relative;
            width: 100%;
            margin-bottom: 20px;
        }

        .password-container .login-input {
            margin-bottom: 0;
            padding-right: 50px;
        }

        .toggle-password {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #64748b;
            cursor: pointer;
            font-size: 18px;
            padding: 4px;
            transition: color 0.3s ease;
        }

        .toggle-password:hover {
            color: #10b981;
        }

        .login-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #059669, #10b981);
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 16px;
            font-weight: 700;
            font-family: 'Prompt', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .login-button:hover {
            background: linear-gradient(135deg, #047857, #059669);
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(5, 150, 105, 0.4);
        }

        .login-hint {
            margin-top: 25px;
            padding: 18px;
            background: #f0fdf4;
            border-radius: 14px;
            font-size: 13px;
            color: #047857;
            border: 1px solid #bbf7d0;
            text-align: center;
        }

        .back-link {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
            padding: 14px;
            color: #059669;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            border: 2px solid #d1fae5;
            border-radius: 14px;
            transition: all 0.3s ease;
            background: #ecfdf5;
        }

        .back-link:hover {
            background: #d1fae5;
            border-color: #10b981;
        }

        .error-message {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 14px 18px;
            border-radius: 12px;
            font-size: 14px;
            margin-bottom: 20px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        #dashboardContent {
            display: none;
        }

        /* Dashboard Container */
        .dashboard-container {
            max-width: 1600px;
            margin: 0 auto;
            display: block;
            animation: fadeIn 0.5s ease;
        }

        /* Header */
        .header-section {
            background: linear-gradient(135deg, #059669 0%, #10b981 50%, #34d399 100%);
            color: white;
            padding: 25px 40px;
            border-radius: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-xl);
        }

        .header-section h1 {
            font-family: 'Outfit', sans-serif;
            font-size: 28px;
            margin-bottom: 8px;
        }

        .header-section p {
            font-size: 13px;
            opacity: 0.95;
        }

        /* Navigation */
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            margin-bottom: 10px;
            gap: 8px;
            flex-wrap: wrap;
        }

        .nav-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 18px;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            border: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Prompt', sans-serif;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-back {
            background: linear-gradient(135deg, #0ea5e9, #38bdf8);
            color: white;
            box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3);
        }

        .btn-back:hover {
            background: linear-gradient(135deg, #0284c7, #0ea5e9);
            box-shadow: 0 8px 24px rgba(14, 165, 233, 0.5);
        }

        .btn-home {
            background: white;
            border: 2px solid var(--danger);
            color: var(--danger);
            box-shadow: 0 4px 12px rgba(244, 63, 94, 0.2);
        }

        .btn-home:hover {
            background: var(--danger);
            color: white;
            box-shadow: 0 8px 24px rgba(244, 63, 94, 0.4);
        }

        .btn-logout {
            background: var(--danger);
            color: white;
            box-shadow: 0 4px 12px rgba(244, 63, 94, 0.3);
        }

        .btn-logout:hover {
            background: #dc2626;
            box-shadow: 0 8px 24px rgba(244, 63, 94, 0.5);
        }

        /* KPI Cards */
        .kpi-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .kpi-box {
            background: var(--card-white);
            padding: 30px 24px;
            border-radius: 24px;
            border: 1px solid #e2e8f0;
            text-align: center;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
        }

        .kpi-box:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-green);
        }

        .kpi-label {
            font-size: 14px;
            font-weight: 800;
            color: var(--text-main);
            text-transform: capitalize;
            letter-spacing: 0.3px;
        }

        .kpi-value {
            font-family: 'Outfit', sans-serif;
            font-size: 38px;
            font-weight: 700;
            color: var(--primary-green);
            margin: 10px 0;
        }

        .kpi-sub {
            font-size: 12px;
            color: var(--text-sub);
        }

        /* Main Content Grid */
        .content-grid {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .chart-col {
            flex: 2;
            background: white;
            padding: 30px;
            border-radius: 28px;
            border: 1px solid #e2e8f0;
            box-shadow: var(--shadow-md);
        }

        .hand-col {
            flex: 1;
            background: white;
            padding: 30px;
            border-radius: 28px;
            border: 1px solid #e2e8f0;
            box-shadow: var(--shadow-md);
            min-width: 400px;
        }

        /* Hand Visualization */
        .hand-viz-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            background: #e0f2fe;
            padding: 25px 15px;
            border-radius: 24px;
            margin-top: 20px;
        }

        .hand-view {
            text-align: center;
        }

        .hand-svg {
            width: 100%;
            max-width: 160px;
            height: auto;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.06));
        }

        .hand-path {
            fill: #f1f5f9;
            stroke: #cbd5e1;
            stroke-width: 1.5;
        }

        .heat-glow {
            filter: blur(10px);
            animation: pulse-heat 2s infinite alternate ease-in-out;
            mix-blend-mode: multiply;
            pointer-events: none;
        }

        @keyframes pulse-heat {
            from {
                opacity: 0.4;
                transform: scale(0.98);
            }

            to {
                opacity: 0.8;
                transform: scale(1.05);
            }
        }

        /* Comparison Card */
        .comparison-card {
            background: white;
            padding: 30px;
            border-radius: 24px;
            border: 1px solid #e2e8f0;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }

        .comparison-item {
            text-align: center;
            padding: 20px;
            background: #f0fdf4;
            border-radius: 16px;
        }

        .comparison-item .label {
            font-size: 12px;
            color: var(--text-sub);
            margin-bottom: 10px;
        }

        .comparison-item .value {
            font-family: 'Outfit', sans-serif;
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-green);
        }

        .comparison-item .diff {
            font-size: 13px;
            font-weight: 700;
            margin-top: 5px;
        }

        .comparison-item .diff.positive {
            color: var(--success);
        }

        .comparison-item .diff.negative {
            color: var(--danger);
        }

        /* Ranking Table */
        .table-section {
            background: white;
            padding: 30px;
            border-radius: 28px;
            border: 1px solid #e2e8f0;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 15px;
            color: var(--text-sub);
            font-size: 11px;
            text-transform: uppercase;
            border-bottom: 2px solid #f1f5f9;
        }

        td {
            padding: 18px 15px;
            font-size: 14px;
            border-bottom: 1px solid #f8fafc;
        }

        tbody tr {
            cursor: pointer;
            transition: background 0.2s;
        }

        tbody tr:hover {
            background: #f1f5f9;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 11px;
        }

        .bg-success {
            background: #dcfce7;
            color: #15803d;
        }

        .bg-danger {
            background: #fee2e2;
            color: #be123c;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .login-card {
                padding: 30px 20px;
            }

            .header-section {
                padding: 20px;
                text-align: center;
            }

            .header-section h1 {
                font-size: 22px;
            }

            .top-nav {
                flex-direction: column;
                gap: 10px;
            }

            .kpi-row {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .content-grid {
                flex-direction: column;
            }

            .hand-col {
                min-width: 100%;
            }

            .hand-viz-grid {
                grid-template-columns: 1fr;
            }

            .comparison-grid {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 12px;
            }

            th,
            td {
                padding: 10px 8px;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .kpi-row {
                grid-template-columns: repeat(2, 1fr);
            }

            .content-grid {
                flex-direction: column;
            }

            .hand-col {
                min-width: 100%;
            }
        }
    </style>
</head>

<body>

    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <div class="login-icon">
                <i class="fa-solid fa-users"></i>
            </div>
            <h1>Department Dashboard Login</h1>
            <p>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Employee ID ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (Enter Employee ID to view your department data)</p>

            <div class="error-message" id="errorMessage">
                <i class="fa-solid fa-circle-exclamation"></i>
                <span>‡πÑ‡∏°‡πà‡∏û‡∏ö Employee ID ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà (Employee ID not found, please try again)</span>
            </div>

            <div class="password-container">
                <input type="password" id="empIdInput" class="login-input" placeholder="Employee ID (‡πÄ‡∏ä‡πà‡∏ô EMP001)"
                    autocomplete="off">
            </div>

            <button class="login-button" onclick="handleLogin()">
                <i class="fa-solid fa-arrow-right-to-bracket"></i>
                <span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö (Login)</span>
            </button>

            <div class="login-hint">
                <i class="fa-solid fa-info-circle"></i>
                <strong>Demo IDs:</strong> EMP001 (ER), EMP015 (ICU), EMP030 (OR), EMP045 (Ward)
            </div>

            <a href="index.html" class="back-link">
                <i class="fa-solid fa-arrow-left"></i>
                <span>‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å (Back to Home)</span>
            </a>
        </div>
    </div>

    <!-- Dashboard Content -->
    <div id="dashboardContent">

        <!-- Dashboard Screen -->
        <div id="dashboardScreen" class="dashboard-container">
            <!-- Top Navigation -->
            <nav class="top-nav" style="display: flex; justify-content: space-between; align-items: center;">
                <div id="backButtonContainer" style="display: none;">
                    <button class="btn btn-back" onclick="location.href='hospital-dashboard.html'">
                        <i class="fa-solid fa-arrow-left"></i> <span>‡∏Å‡∏•‡∏±‡∏ö IC Dashboard (Back to IC Dashboard)</span>
                    </button>
                </div>
                <div style="flex: 1;"></div>
                <button class="btn btn-logout" onclick="handleLogout()"
                    style="background-color: #ef4444; color: white; border: none; margin-left: auto;">
                    <i class="fa-solid fa-right-from-bracket"></i> <span>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö (Logout)</span>
                </button>
            </nav>

            <!-- Header -->
            <header class="header-section">
                <h1 id="deptName">‡πÅ‡∏ú‡∏ô‡∏Å ER (Emergency Room)</h1>
                <p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏°‡∏∑‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (Your Department Hand Hygiene Data) | 30-31 ‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° 2568</p>
            </header>

            <!-- KPI Row -->
            <div class="kpi-row">
                <div class="kpi-box">
                    <div class="kpi-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÅ‡∏ú‡∏ô‡∏Å (Department Average)</div>
                    <div class="kpi-value" id="deptAvg">0%</div>
                    <div class="kpi-sub">Department Average</div>
                </div>
                <div class="kpi-box">
                    <div class="kpi-label">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå (Pass Rate ‚â•80%)</div>
                    <div class="kpi-value" id="deptPass">12.5%</div>
                    <div class="kpi-sub">Compliance Rate</div>
                </div>
                <div class="kpi-box">
                    <div class="kpi-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Logs (Total Logs)</div>
                    <div class="kpi-value" id="deptLogs">0</div>
                    <div class="kpi-sub">Total Records</div>
                </div>
                <div class="kpi-box">
                    <div class="kpi-label">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏Å (Department Rank)</div>
                    <div class="kpi-value" id="deptRank">#0/12</div>
                    <div class="kpi-sub" data-translate="kpi-rank-sub">Hospital Ranking</div>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div class="content-grid">
                <div class="chart-col">
                    <h3 style="font-size: 17px; font-weight: 700; color: var(--text-main); margin-bottom: 20px;">
                        <i class="fa-solid fa-chart-line" style="color: var(--primary-green);"></i>
                        <span data-translate="header-trend">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏Å (Department Trend)</span>
                    </h3>
                    <div style="height: 300px; position: relative;">
                        <canvas id="trendChart"></canvas>
                    </div>
                </div>

                <div class="hand-col">
                    <h3 style="font-size: 17px; font-weight: 700; color: var(--text-main); margin-bottom: 20px;">
                        <i class="fa-solid fa-hand-dots" style="color: var(--primary-green);"></i>
                        <span data-translate="header-11-zone">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå 11 ‡πÇ‡∏ã‡∏ô (11-Zone Analysis)</span>
                    </h3>
                    <div class="hand-viz-grid">
                        <div class="hand-view">
                            <p
                                style="font-size: 10px; font-weight: 800; margin-bottom: 12px; color: var(--primary-green);">
                                ‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏∑‡∏≠ (Palm)</p>
                            <svg class="hand-svg" viewBox="0 0 200 250">
                                <path class="hand-path"
                                    d="M100 240 Q70 240 55 210 Q45 190 40 160 Q30 150 15 110 Q5 90 15 70 Q25 50 35 60 L45 90 L40 30 Q40 10 55 10 Q70 10 70 40 L75 95 L85 15 Q85 -5 100 -5 Q115 -5 115 25 L115 95 L125 20 Q125 0 140 0 Q155 0 155 30 L155 100 L165 50 Q165 35 180 35 Q195 35 185 80 Q175 120 180 160 Q180 200 160 230 Q140 240 100 240 Z" />
                                <circle class="heat-glow" cx="100" cy="170" r="40" fill="var(--danger)" />
                            </svg>
                            <div style="font-size: 14px; font-weight: 800; color: var(--danger); margin-top:10px;">‡∏´‡∏ô‡πâ‡∏≤:
                                <span id="frontAvg">31.4</span>%
                            </div>
                        </div>
                        <div class="hand-view">
                            <p
                                style="font-size: 10px; font-weight: 800; margin-bottom: 12px; color: var(--primary-green);">
                                ‡∏´‡∏•‡∏±‡∏á‡∏°‡∏∑‡∏≠ (Back)</p>
                            <svg class="hand-svg" viewBox="0 0 200 250">
                                <path class="hand-path"
                                    d="M100 240 Q70 240 55 210 Q45 190 40 160 Q30 150 15 110 Q5 90 15 70 Q25 50 35 60 L45 90 L40 30 Q40 10 55 10 Q70 10 70 40 L75 95 L85 15 Q85 -5 100 -5 Q115 -5 115 25 L115 95 L125 20 Q125 0 140 0 Q155 0 155 30 L155 100 L165 50 Q165 35 180 35 Q195 35 185 80 Q175 120 180 160 Q180 200 160 230 Q140 240 100 240 Z" />
                                <rect class="heat-glow" x="60" y="140" width="80" height="50" rx="20"
                                    fill="var(--danger)" />
                            </svg>
                            <div style="font-size: 14px; font-weight: 800; color: var(--danger); margin-top:10px;">‡∏´‡∏•‡∏±‡∏á:
                                <span id="backAvg">27.8</span>%
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comparison Card -->
            <div class="comparison-card">
                <h3 style="font-size: 17px; font-weight: 700; color: var(--text-main); margin-bottom: 10px;">
                    <i class="fa-solid fa-scale-balanced" style="color: var(--primary-green);"></i>
                    <span data-translate="header-comparison">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• (Hospital
                        Comparison)</span>
                </h3>
                <div class="comparison-grid">
                    <div class="comparison-item">
                        <div class="label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å vs ‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</div>
                        <div class="value" id="compAvg">31.5%</div>
                        <div class="diff positive" id="compAvgDiff">+1.9% ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
                    </div>
                    <div class="comparison-item">
                        <div class="label">Pass Rate ‡πÅ‡∏ú‡∏ô‡∏Å vs ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</div>
                        <div class="value" id="compPass">12.5%</div>
                        <div class="diff positive" id="compPassDiff">+3.8% ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
                    </div>
                    <div class="comparison-item">
                        <div class="label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Logs vs ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
                        <div class="value" id="compLogs">48</div>
                        <div class="diff positive" id="compLogsDiff">+15 ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
                    </div>
                </div>
            </div>

            <!-- Staff Ranking Table -->
            <div class="table-section">
                <h3 style="font-size: 17px; font-weight: 700; color: var(--text-main); margin-bottom: 25px;">
                    <i class="fa-solid fa-ranking-star" style="color: var(--primary-green);"></i>
                    <span data-translate="header-ranking">Ranking ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å (Staff Rankings)</span> <span
                        style="font-size: 13px; color: var(--text-sub); font-style: italic;">(‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î)</span>
                </h3>
                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Employee ID</th>
                            <th>Name</th>
                            <th>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</th>
                            <th>‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏∑‡∏≠</th>
                            <th>‡∏´‡∏•‡∏±‡∏á‡∏°‡∏∑‡∏≠</th>
                            <th>Logs</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="staffTableBody">
                        <!-- Staff rows will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <script>
            // ============================================
            // MOCK DATABASE
            // ============================================
            const database = {
                users: {
                    'EMP001': { name: 'Dr. Somchai Ruangsri', dept: 'ER' },
                    'EMP015': { name: 'Dr. Wichai Sukjai', dept: 'ICU' },
                    'EMP030': { name: 'Dr. Narong Kaewmala', dept: 'OR' },
                    'EMP045': { name: 'Nurse Apinya Wongsawat', dept: 'Ward' }
                },
                departments: {
                    'ER': {
                        name: '‡πÅ‡∏ú‡∏ô‡∏Å ER (Emergency Room)',
                        stats: { avgScore: 62.8, passRate: 25.0, totalLogs: 39, rank: '#3/12' },
                        trend: [
                            { date: '09/11', score: 58.2 }, { date: '10/11', score: 60.5 },
                            { date: '11/11', score: 61.8 }, { date: '12/11', score: 59.3 },
                            { date: '13/11', score: 63.7 }, { date: '14/11', score: 65.2 },
                            { date: '15/11', score: 62.8 }
                        ],
                        staff: [
                            { id: 'EMP001', name: 'Dr. Somchai Ruangsri', score: 88.5, front: 90, back: 87, logs: 12, status: 'Pass' },
                            { id: 'EMP002', name: 'Nurse Pranee Sukjai', score: 80.2, front: 82, back: 78, logs: 10, status: 'Pass' },
                            { id: 'EMP003', name: 'Dr. Wanida Pongpan', score: 47.5, front: 50, back: 45, logs: 8, status: 'Fail' },
                            { id: 'EMP004', name: 'Nurse Suwan Thongdee', score: 35.2, front: 38, back: 32, logs: 9, status: 'Fail' }
                        ]
                    },
                    'ICU': {
                        name: '‡πÅ‡∏ú‡∏ô‡∏Å ICU (Intensive Care Unit)',
                        stats: { avgScore: 82.5, passRate: 66.7, totalLogs: 37, rank: '#1/12' },
                        trend: [
                            { date: '09/11', score: 78.5 }, { date: '10/11', score: 80.2 },
                            { date: '11/11', score: 81.8 }, { date: '12/11', score: 83.1 },
                            { date: '13/11', score: 84.5 }, { date: '14/11', score: 83.7 },
                            { date: '15/11', score: 82.5 }
                        ],
                        staff: [
                            { id: 'EMP015', name: 'Dr. Wichai Sukjai', score: 86.8, front: 88, back: 85, logs: 15, status: 'Pass' },
                            { id: 'EMP016', name: 'Nurse Ploy Chai', score: 82.5, front: 84, back: 81, logs: 12, status: 'Pass' },
                            { id: 'EMP017', name: 'Dr. Chai Wongsawat', score: 78.2, front: 80, back: 76, logs: 10, status: 'Fail' }
                        ]
                    },
                    'OR': {
                        name: '‡πÅ‡∏ú‡∏ô‡∏Å OR (Operating Room)',
                        stats: { avgScore: 93.1, passRate: 100.0, totalLogs: 39, rank: '#1/12' },
                        trend: [
                            { date: '09/11', score: 91.2 }, { date: '10/11', score: 92.5 },
                            { date: '11/11', score: 93.8 }, { date: '12/11', score: 94.1 },
                            { date: '13/11', score: 93.5 }, { date: '14/11', score: 92.8 },
                            { date: '15/11', score: 93.1 }
                        ],
                        staff: [
                            { id: 'EMP030', name: 'Dr. Narong Kaewmala', score: 95.3, front: 96, back: 94, logs: 14, status: 'Pass' },
                            { id: 'EMP031', name: 'Nurse Mai Pong', score: 92.8, front: 94, back: 91, logs: 13, status: 'Pass' },
                            { id: 'EMP032', name: 'Dr. Krit Suk', score: 91.2, front: 92, back: 90, logs: 12, status: 'Pass' }
                        ]
                    },
                    'Ward': {
                        name: '‡πÅ‡∏ú‡∏ô‡∏Å Ward (General Ward)',
                        stats: { avgScore: 68.8, passRate: 0.0, totalLogs: 28, rank: '#8/12' },
                        trend: [
                            { date: '09/11', score: 65.2 }, { date: '10/11', score: 66.8 },
                            { date: '11/11', score: 68.5 }, { date: '12/11', score: 69.7 },
                            { date: '13/11', score: 70.2 }, { date: '14/11', score: 69.5 },
                            { date: '15/11', score: 68.8 }
                        ],
                        staff: [
                            { id: 'EMP045', name: 'Nurse Apinya Wongsawat', score: 75.5, front: 78, back: 73, logs: 11, status: 'Fail' },
                            { id: 'EMP046', name: 'Dr. Pong Chai', score: 68.8, front: 71, back: 66, logs: 9, status: 'Fail' },
                            { id: 'EMP047', name: 'Nurse Joy Ploy', score: 62.1, front: 65, back: 59, logs: 8, status: 'Fail' }
                        ]
                    }
                }
            };


            let deptTrendChart = null;
            const translations = {
                th: {
                    // Login Screen
                    'login-title': 'Department Dashboard Login',
                    'login-subtitle': '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Employee ID ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì',
                    'login-button': '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö',
                    'login-error': '‡πÑ‡∏°‡πà‡∏û‡∏ö Employee ID ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á',
                    'back-home': '‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å',

                    // Navigation
                    'btn-back-ic': '‡∏Å‡∏•‡∏±‡∏ö IC Dashboard',
                    'btn-home': '‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å',
                    'btn-logout': '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö',

                    // Header
                    'dept-subtitle': '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏°‡∏∑‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì',

                    // KPI Labels
                    'kpi-dept-avg': '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÅ‡∏ú‡∏ô‡∏Å',
                    'kpi-dept-avg-sub': 'Department Average',
                    'kpi-pass-rate': '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå (‚â•80%)',
                    'kpi-pass-rate-sub': 'Compliance Rate',
                    'kpi-logs': '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Logs',
                    'kpi-logs-sub': 'Total Records',
                    'kpi-rank': '‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏Å',
                    'kpi-rank-sub': 'Hospital Ranking',

                    // Section Headers
                    'header-trend': '‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏Å',
                    'header-11-zone': '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå 11 ‡πÇ‡∏ã‡∏ô',
                    'header-comparison': '‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•',
                    'header-comparison-sub': '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å vs ‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•',
                    'header-ranking': 'Ranking ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å',
                    'header-ranking-sub': '‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î',

                    // Table Headers
                    'th-rank': 'Rank',
                    'th-emp-id': 'Employee ID',
                    'th-name': 'Name',
                    'th-avg': '‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢',
                    'th-front': '‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏∑‡∏≠',
                    'th-back': '‡∏´‡∏•‡∏±‡∏á‡∏°‡∏∑‡∏≠',
                    'th-logs': 'Logs',
                    'th-status': 'Status',

                    // Comparison
                    'comp-above-avg': '‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢',
                    'comp-more-than': '‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢',

                    // Status
                    'status-pass': '‡∏ú‡πà‡∏≤‡∏ô',
                    'status-fail': '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô',

                    // Months
                    'month-october': '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°'
                },
                en: {
                    // Login Screen
                    'login-title': 'Department Dashboard Login',
                    'login-subtitle': 'Enter your Employee ID to view your department data',
                    'login-button': 'Login',
                    'login-error': 'Employee ID not found. Please try again',
                    'back-home': 'Back to Home',

                    // Navigation
                    'btn-back-ic': 'Back to IC Dashboard',
                    'btn-home': 'Back to Home',
                    'btn-logout': 'Logout',

                    // Header
                    'dept-subtitle': 'Your Department Hand Hygiene Data',

                    // KPI Labels
                    'kpi-dept-avg': 'Department Average',
                    'kpi-dept-avg-sub': 'Department Average',
                    'kpi-pass-rate': 'Pass Rate (‚â•80%)',
                    'kpi-pass-rate-sub': 'Compliance Rate',
                    'kpi-logs': 'Total Logs',
                    'kpi-logs-sub': 'Total Records',
                    'kpi-rank': 'Department Rank',
                    'kpi-rank-sub': 'Hospital Ranking',

                    // Section Headers
                    'header-trend': 'Department Trend',
                    'header-11-zone': '11-Zone Analysis',
                    'header-comparison': 'Hospital Comparison',
                    'header-comparison-sub': 'Department Score vs Hospital',
                    'header-ranking': 'Staff Rankings',
                    'header-ranking-sub': 'Click to view details',

                    // Table Headers
                    'th-rank': 'Rank',
                    'th-emp-id': 'Employee ID',
                    'th-name': 'Name',
                    'th-avg': 'Average',
                    'th-front': 'Palm Avg',
                    'th-back': 'Back',
                    'th-logs': 'Logs',
                    'th-status': 'Status',

                    // Comparison
                    'comp-above-avg': 'above average',
                    'comp-more-than': 'more than average',

                    // Status
                    'status-pass': 'Pass',
                    'status-fail': 'Fail',

                    // Months
                    'month-october': 'October'
                }
            };

            // Auto-add data-translate attributes to elements
            function autoAddTranslateAttributes() {
                const mappings = {
                    // Headers
                    '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏°‡∏∑‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì': 'dept-subtitle',
                    '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°': 'month-october',

                    // Section Headers
                    '‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏Å': 'header-trend',
                    '‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå 11 ‡πÇ‡∏ã‡∏ô': 'header-11-zone',
                    '‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•': 'header-comparison',
                    '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å vs ‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•': 'header-comparison-sub',
                    'Ranking ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡πÉ‡∏ô‡πÅ‡∏ú‡∏ô‡∏Å': 'header-ranking',
                    '‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î': 'header-ranking-sub',

                    // Table Headers
                    'Rank': 'th-rank',
                    'Employee ID': 'th-emp-id',
                    'Name': 'th-name',
                    '‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢': 'th-avg',
                    '‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏°‡∏∑‡∏≠': 'th-front',
                    '‡∏´‡∏•‡∏±‡∏á‡∏°‡∏∑‡∏≠': 'th-back',
                    'Logs': 'th-logs',
                    'Status': 'th-status',

                    // Comparison
                    '‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢': 'comp-above-avg',
                    '‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢': 'comp-more-than',

                    // Status
                    '‡∏ú‡πà‡∏≤‡∏ô': 'status-pass',
                    '‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô': 'status-fail'
                };

                // Add data-translate to matching elements
                document.querySelectorAll('label, th, h3, h4, span, div, p').forEach(el => {
                    if (el.children.length === 0 && !el.hasAttribute('data-translate')) {
                        const text = el.textContent.trim();
                        // Handle text with icons
                        const cleanText = text.replace(/[‚úì‚úó]/g, '').trim();
                        if (mappings[text] || mappings[cleanText]) {
                            el.setAttribute('data-translate', mappings[text] || mappings[cleanText]);
                        }
                    }
                });
            }


            // Apply language to all translatable elements
            function updateLanguage(lang) {
                const trans = translations[lang] || translations['th'];

                // Apply translations to elements with data-translate attribute
                document.querySelectorAll('[data-translate]').forEach(el => {
                    const key = el.getAttribute('data-translate');
                    if (trans[key]) {
                        if (el.tagName === 'INPUT') {
                            el.placeholder = trans[key];
                        } else {
                            el.textContent = trans[key];
                        }
                    }
                });
            }

            // Initialize language on page load
            (function () {
                const savedLang = localStorage.getItem('selectedLanguage') || localStorage.getItem('preferredLanguage') || 'th';
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => {
                        autoAddTranslateAttributes();
                        updateLanguage(savedLang);
                    });
                } else {
                    autoAddTranslateAttributes();
                    updateLanguage(savedLang);
                }
            })();

            function handleLogin() {
                const empInput = document.getElementById('empIdInput');
                const errorMsg = document.getElementById('errorMessage');
                if (!empInput) return;

                const empId = empInput.value.trim().toUpperCase();

                if (database.users[empId]) {
                    const user = database.users[empId];
                    sessionStorage.setItem('dept_authenticated', 'true');
                    sessionStorage.setItem('dept_empId', empId);
                    sessionStorage.setItem('dept_id', user.dept);

                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('dashboardContent').style.display = 'block';
                    loadDashboard(user.dept);
                } else {
                    if (errorMsg) errorMsg.style.display = 'flex';
                    empInput.value = '';
                    empInput.focus();
                }
            }

            function loadDashboard(deptId) {
                const deptData = database.departments[deptId];
                if (!deptData) return;

                // Update header
                const deptNameEl = document.getElementById('deptName');
                if (deptNameEl) deptNameEl.textContent = deptData.name;

                // Update KPIs - MATCHING EXACT HTML IDs
                const deptAvgEl = document.getElementById('deptAvg');
                const deptPassEl = document.getElementById('deptPass');
                const deptLogsEl = document.getElementById('deptLogs');
                const deptRankEl = document.getElementById('deptRank');

                if (deptAvgEl) deptAvgEl.textContent = deptData.stats.avgScore.toFixed(1) + '%';
                if (deptPassEl) deptPassEl.textContent = deptData.stats.passRate.toFixed(1) + '%';
                if (deptLogsEl) deptLogsEl.textContent = deptData.stats.totalLogs;
                if (deptRankEl) deptRankEl.textContent = deptData.stats.rank;

                // Update comparison
                const compAvgEl = document.getElementById('compAvg');
                const compPassEl = document.getElementById('compPass');
                const compLogsEl = document.getElementById('compLogs');

                if (compAvgEl) compAvgEl.textContent = deptData.stats.avgScore.toFixed(1) + '%';
                if (compPassEl) compPassEl.textContent = deptData.stats.passRate.toFixed(1) + '%';
                if (compLogsEl) compLogsEl.textContent = deptData.stats.totalLogs;

                renderTrendChart(deptData.trend);
                renderRankingsTable(deptData.staff);
            }

            function renderTrendChart(trendData) {
                const canvas = document.getElementById('trendChart');
                if (!canvas) return;

                if (deptTrendChart) deptTrendChart.destroy();

                const ctx = canvas.getContext('2d');
                const labels = trendData.map(t => t.date);
                const scores = trendData.map(t => t.score);

                deptTrendChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÅ‡∏ú‡∏ô‡∏Å (%)',
                            data: scores,
                            borderColor: 'rgb(5, 150, 105)',
                            backgroundColor: 'rgba(5, 150, 105, 0.1)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true,
                            pointRadius: 6,
                            pointBackgroundColor: 'rgb(5, 150, 105)',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        }, {
                            label: '‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ú‡πà‡∏≤‡∏ô (80%)',
                            data: Array(labels.length).fill(80),
                            borderColor: 'rgb(239, 68, 68)',
                            borderWidth: 2,
                            borderDash: [10, 5],
                            pointRadius: 0,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true, position: 'top' }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                ticks: { callback: function (value) { return value + '%'; } }
                            }
                        }
                    }
                });
            }

            function renderRankingsTable(staffData) {
                const tbody = document.getElementById('staffTableBody');
                if (!tbody) return;

                tbody.innerHTML = '';
                const sortedStaff = [...staffData].sort((a, b) => b.score - a.score);

                sortedStaff.forEach((emp, index) => {
                    const rank = index + 1;
                    const isPassed = emp.score >= 80;
                    const scoreColor = isPassed ? 'var(--success)' : 'var(--danger)';

                    const row = document.createElement('tr');
                    row.style.cursor = 'pointer';
                    row.onclick = function () {
                        window.location.href = `personal-dashboard.html?source=dept&id=${emp.id}`;
                    };

                    row.innerHTML = `
                        <td style="padding: 14px; text-align: center; font-weight: 700;">
                            ${rank <= 3 ? 'üèÜ' : ''} ${rank}
                        </td>
                        <td style="padding: 14px; text-align: center; font-weight: 600;">${emp.id}</td>
                        <td style="padding: 14px; font-weight: 600;">${emp.name}</td>
                        <td style="padding: 14px; text-align: center; font-size: 16px; font-weight: 700; color: ${scoreColor};">
                            ${emp.score.toFixed(1)}%
                        </td>
                        <td style="padding: 14px; text-align: center; font-weight: 600;">${emp.front}%</td>
                        <td style="padding: 14px; text-align: center; font-weight: 600;">${emp.back}%</td>
                        <td style="padding: 14px; text-align: center;">${emp.logs}</td>
                        <td style="padding: 14px; text-align: center;">
                            <span style="padding: 4px 12px; border-radius: 12px; font-size: 11px; font-weight: 700; background: ${isPassed ? '#d1fae5' : '#ffe4e6'}; color: ${scoreColor};">
                                ${isPassed ? '‚úì ‡∏ú‡πà‡∏≤‡∏ô' : '‚úó ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô'}
                            </span>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }

            function handleLogout() {
                sessionStorage.clear();
                location.reload();
            }

            document.addEventListener('DOMContentLoaded', function () {
                const params = new URLSearchParams(window.location.search);
                const isICView = params.get('source') === 'ic';
                const deptCode = params.get('dept');

                if (isICView && deptCode) {
                    sessionStorage.setItem('dept_authenticated', 'true');
                    sessionStorage.setItem('dept_id', deptCode);
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('dashboardContent').style.display = 'block';
                    loadDashboard(deptCode);
                } else {
                    const isAuth = sessionStorage.getItem('dept_authenticated');
                    const storedDept = sessionStorage.getItem('dept_id');

                    if (isAuth === 'true' && storedDept) {
                        document.getElementById('loginScreen').style.display = 'none';
                        document.getElementById('dashboardContent').style.display = 'block';
                        loadDashboard(storedDept);
                    } else {
                        document.getElementById('loginScreen').style.display = 'flex';
                        document.getElementById('dashboardContent').style.display = 'none';
                    }
                }

                const empInput = document.getElementById('empIdInput');
                if (empInput) {
                    empInput.addEventListener('keypress', function (e) {
                        if (e.key === 'Enter') handleLogin();
                    });
                }
            });


        </script>
    </div>
</body>

</html>